<title>Oly Data Source Inteface</title>
<nowiki>
<div id="asciidoc">
<h1>Oly Data Source Interface</h1>
<p>
<tt>&lt;<a href="mailto:maintainer@fakesite.com">maintainer@fakesite.com</a>&gt;</tt><br>
version 0f71aa1190,
2014-03-19
</p>
<hr>
<h2><a name="_functions"></a>Functions</h2>
<h3><a name="_required_functions"></a>Required functions</h3>
<p><b>Must be defined</b></p><dl>
<dt>
open_oly_ds_stream
</dt>
<dd>
<p>
Try to connect to the data source.  If successful, open the stream from the data source.
</p>
</dd>
<dt>
close_oly_ds_stream
</dt>
<dd>
<p>
Flush the current stream buffers in the stream direction, stop any queries against this stream and free any pointers allocated by the stream.
</p>
<div class="listingblock">
<div class="title">close_oly_ds_stream definition</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">OlyStatus</span> <span style="font-weight: bold"><span style="color: #000000">close_oly_ds_stream</span></span><span style="color: #990000">(</span><span style="color: #008080">OlyDataSource</span> <span style="color: #990000">*</span>ds<span style="color: #990000">);</span></tt></pre></div></div>
</dd>
<dt>
get_oly_ds_metadata
</dt>
<dd>
<p>
Retrieve metadata at granularity specified.  Will go into greater detail once this is more firmly defined.  Must be thread-safe.
</p>
<div class="listingblock">
<div class="title">get_oly_ds_metadata definition</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">OlyStatus</span> <span style="font-weight: bold"><span style="color: #000000">get_oly_ds_metadata</span></span><span style="color: #990000">(</span><span style="color: #008080">OlyDataSource</span> <span style="color: #990000">*</span>ds<span style="color: #990000">);</span></tt></pre></div></div>
</dd>
<dt>
get_oly_ds_error_message
</dt>
<dd>
<p>
See <a href="#_open_questions">open questions</a>.
</p>
</dd>
</dl>
<p><b>Not sure about these</b></p><dl>
<dt>
flush_oly_ds_buffer
</dt>
<dd>
<p>
Should this be necessary?  Probably, eh?  Oly needs to have control over the stream on a direct level, but should that be part of closing?  Also, what about direction?  Is this for output only?
</p>
</dd>
<dt>
fill_oly_ds_buffer
</dt>
<dd>
<p>
Same thing.  Needed?  Wanted?  How should this work?
</p>
</dd>
<dt>
get_oly_ds_error_number
</dt>
<dd>
<p>
See <a href="#_open_questions">open questions</a>.
</p>
</dd>
</dl>
<h3><a name="_open_questions"></a>Open Questions</h3>
<ol type="1">
<li>
<p>
Should error numbers be defined by Oly or by the data source?  I think Oly.
</p>
</li>
<li>
<p>
However, there will be data source errors that Oly cannot predict.  Thus, "get_oly_ds_error_message" should return those.
</p>
</li>
</ol>
<hr>
<h2><a name="_data_stream"></a>Data Stream</h2>
<ol type="1">
<li>
<p>
The stream will use the Oly data source conversion functions to get the data into a state friendly to Oly.
</p>
</li>
<li>
<p>
Stream direction must be in or out.  To use one data source in both directions, open two streams.
</p>
</li>
<li>
<p>
Stream will checkpoint in a way that makes sense.  This depends on whether it is writing to a table or a document type data source.
</p>
</li>
<li>
<p>
Stream will use data source&#8217;s native functionality to ensure whatever data was written is atomic.
</p>
</li>
<li>
<p>
Oly will recover to last checkpoint in the event of a sudden stop.
</p>
</li>
</ol>
<hr>
<h2><a name="_structures"></a>Structures</h2>
<h3><a name="_collection_centered_data"></a>Collection-centered data</h3>
<p>As of 3-19-2013, Oly&#8217;s collection-centered data processing is not concerned about type.  This may change in the future.</p>
<h4><a name="_collection"></a>Collection</h4>
<p>A collection holds tuples or keys, each of which references values.  At a macro level, collection-centered data will be a collection of tuples, keys, collections and values.</p>
<h4><a name="_tuple"></a>Tuple</h4>
<p>A numeric identifier for a value.  If the source data actually has values for these, Oly will try to preserve them.  If no values are available, then oly will assign ascending tuples within a single collection.  Within a collection, tuples must be unique; a non-unique tuple in a collection must be handled by Oly or the data source itself.</p>
<h4><a name="_key"></a>Key</h4>
<p>A scalar identifier for a value.</p>
<h4><a name="_value"></a>Value</h4>
<p>A collection or a scalar.</p>
<h4><a name="_scalar"></a>Scalar</h4>
<p>Term from <a href="http://www.yaml.org/spec/1.2/spec.html#scalar//">yaml</a>, which defines it as " an opaque datum that can be presented as a series of zero or more Unicode characters."  Can be a key or a value.</p>
<h3><a name="_table_centered_data"></a>Table-centered data</h3>
<h4><a name="_table"></a>Table</h4>
<p>A row and column based data storage structure.  A CSV file would be a good example.</p>
<h4><a name="_row"></a>Row</h4>
<p>One row of a table.</p>
<h4><a name="_column"></a>Column</h4>
<p>One typed column, identifiable by either its name or its number.  If type is not provided, for now, Oly assumes the type is "text".</p>
<h3><a name="_metadata"></a>Metadata</h3>
<p>What information should be here?</p>
<ol type="1">
<li>
<p>
Data source direction (in or out)
</p>
</li>
<li>
<p>
Oly data source buffer size
</p>
</li>
<li>
<p>
Threads?
</p>
</li>
<li>
<p>
Connection information?
</p>
</li>
</ol>
<hr>
<h2><a name="_data_source_8594_structure_maps"></a>Data Source &#8594; Structure Maps</h2>
<h3><a name="_icu_resource_bundle"></a>ICU Resource Bundle</h3>
<p>Resource bundle &#8594; collection.
Key &#8594; key
Index &#8594; tuple
Array &#8594; collection (with tuples only)
Table &#8594; collection (with keys only)</p>
</div>
</nowiki>
